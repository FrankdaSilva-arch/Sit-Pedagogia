{% extends 'loja/base.html' %}
{% load static %}

{% block title %}Visualizar Pagamentos{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center mb-4">Visualizar Pagamentos</h1>

    <h2 class="mb-3">Pagamentos Realizados</h2>
    <div class="table-responsive mb-5">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Pedido</th>
                    <th>Comprador</th>
                    <th>Produto</th>
                    <th>Cota</th>
                    <th>Valor</th>
                    <th>Status</th>
                    <th>Data</th>
                    <th>Comprovante</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                    <tr>
                        <td>{{ pedido.id }}</td>
                        <td>{{ pedido.nome_comprador }}</td>
                        <td>{{ pedido.produto.nome }}</td>
                        <td>{{ pedido.cota }}</td>
                        <td>R$ {{ pedido.valor }}</td>
                        <td>
                            {% if pedido.status == 'pendente' %}
                                <span class="badge bg-warning">Pendente</span>
                            {% elif pedido.status == 'pago' %}
                                <span class="badge bg-success">Pago</span>
                            {% elif pedido.status == 'cancelado' %}
                                <span class="badge bg-danger">Cancelado</span>
                            {% endif %}
                        </td>
                        <td>{{ pedido.data|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if pedido.comprovantes.all %}
                                <a href="{{ pedido.comprovantes.first.arquivo.url }}" target="_blank" class="btn btn-sm btn-info">
                                    Ver Comprovante
                                </a>
                            {% else %}
                                <span class="badge bg-secondary">Sem comprovante</span>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="8" class="text-center">Nenhum pedido encontrado.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <h2 class="mb-3">Cotas Disponíveis</h2>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Cota</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for produto in produtos %}
                    {% for cota in produto.cotas_disponiveis %}
                        <tr>
                            <td>{{ produto.nome }}</td>
                            <td>{{ cota }}</td>
                            <td>
                                <span class="badge bg-secondary">Disponível</span>
                            </td>
                        </tr>
                    {% endfor %}
                {% empty %}
                    <tr>
                        <td colspan="3" class="text-center">Nenhuma cota disponível.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %} 