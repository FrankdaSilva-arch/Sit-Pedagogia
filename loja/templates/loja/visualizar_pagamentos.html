{% extends 'loja/base.html' %}
{% load static %}

{% block title %}Visualizar Pagamentos{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center mb-4">Visualizar Pagamentos</h1>

    {% if configuracao %}
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Chave PIX</h5>
                <div class="input-group">
                    <input type="text" class="form-control" value="{{ configuracao.chave_pix }}" readonly>
                    <button class="btn btn-outline-secondary" type="button" onclick="copiarChavePix()">
                        <i class="fas fa-copy"></i> Copiar
                    </button>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Pedido</th>
                    <th>Comprador</th>
                    <th>Produto</th>
                    <th>Cota</th>
                    <th>Valor</th>
                    <th>Status</th>
                    <th>Data</th>
                    <th>Comprovante</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                    <tr>
                        <td>{{ pedido.id }}</td>
                        <td>{{ pedido.nome_comprador }}</td>
                        <td>{{ pedido.produto.nome }}</td>
                        <td>{{ pedido.cota }}</td>
                        <td>R$ {{ pedido.valor }}</td>
                        <td>
                            {% if pedido.status == 'pendente' %}
                                <span class="badge bg-warning">Pendente</span>
                            {% elif pedido.status == 'pago' %}
                                <span class="badge bg-success">Pago</span>
                            {% elif pedido.status == 'cancelado' %}
                                <span class="badge bg-danger">Cancelado</span>
                            {% endif %}
                        </td>
                        <td>{{ pedido.data|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if pedido.comprovantes.all %}
                                <a href="{{ pedido.comprovantes.first.arquivo.url }}" target="_blank" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i> Ver
                                </a>
                            {% else %}
                                <span class="badge bg-secondary">Sem comprovante</span>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="8" class="text-center">Nenhum pedido encontrado.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function copiarChavePix() {
        const chavePix = event.target.closest('.input-group').querySelector('input');
        chavePix.select();
        document.execCommand('copy');
        
        // Mostrar mensagem de sucesso
        const botao = event.target.closest('button');
        const textoOriginal = botao.innerHTML;
        botao.innerHTML = '<i class="fas fa-check"></i> Copiado!';
        
        // Restaurar texto original apÃ³s 2 segundos
        setTimeout(() => {
            botao.innerHTML = textoOriginal;
        }, 2000);
    }
</script>
{% endblock %} 